# TaskFlow API 설계 문서 (ARD)
**프로젝트**: TaskFlow  
**API 버전**: v1  
**작성일**: 2025.07.22  
**Base URL**: `https://api.taskflow.com/api/v1/`

## 📋 목차
1. [API 개요](#api-개요)
2. [인증 방식](#인증-방식)
3. [공통 응답 형식](#공통-응답-형식)
4. [사용자 관리 API](#사용자-관리-api)
5. [워크스페이스 API](#워크스페이스-api)
6. [페이지 관리 API](#페이지-관리-api)
7. [블록 시스템 API](#블록-시스템-api)
8. [캘린더 API](#캘린더-api)
9. [칸반 보드 API](#칸반-보드-api)
10. [파일 업로드 API](#파일-업로드-api)

---

## 🎯 API 개요

### 설계 원칙
- **RESTful 설계**: 자원 기반 URL 구조
- **일관성**: 모든 API에서 동일한 응답 형식
- **버전 관리**: URL 경로에 버전 명시
- **보안**: JWT 토큰 기반 인증
- **성능**: 페이지네이션 및 필터링 지원

### HTTP 상태 코드
- `200 OK`: 성공
- `201 Created`: 생성 성공
- `204 No Content`: 삭제 성공
- `400 Bad Request`: 잘못된 요청
- `401 Unauthorized`: 인증 실패
- `403 Forbidden`: 권한 없음
- `404 Not Found`: 리소스 없음
- `500 Internal Server Error`: 서버 오류

---

## 🔐 인증 방식

### JWT 토큰 인증
```http
Authorization: Bearer <access_token>
```

### 토큰 갱신
```http
POST /auth/token/refresh/
Content-Type: application/json

{
  "refresh": "refresh_token_here"
}
```

### 소셜 로그인 플로우
```http
# 1. 소셜 로그인 URL 요청
GET /auth/social/{provider}/

# 2. 콜백 처리
POST /auth/social/{provider}/callback/
{
  "code": "authorization_code",
  "state": "csrf_state"
}
```

---

## 📄 공통 응답 형식

### 성공 응답
```json
{
  "success": true,
  "data": {
    // 실제 데이터
  },
  "message": "Success",
  "timestamp": "2025-07-22T10:30:00Z"
}
```

### 오류 응답
```json
{
  "success": false,
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "입력값이 올바르지 않습니다.",
    "details": {
      "email": ["이미 사용 중인 이메일입니다."]
    }
  },
  "timestamp": "2025-07-22T10:30:00Z"
}
```

### 페이지네이션 응답
```json
{
  "success": true,
  "data": {
    "results": [/* 데이터 배열 */],
    "pagination": {
      "count": 100,
      "next": "https://api.taskflow.com/api/v1/pages/?page=3",
      "previous": "https://api.taskflow.com/api/v1/pages/?page=1",
      "page": 2,
      "page_size": 20,
      "total_pages": 5
    }
  }
}
```

---

## 👥 사용자 관리 API

### 회원가입
```http
POST /auth/register/
Content-Type: application/json

{
  "email": "user@example.com",
  "password": "secure_password123",
  "first_name": "홍",
  "last_name": "길동",
  "timezone": "Asia/Seoul"
}
```

**응답**:
```json
{
  "success": true,
  "data": {
    "user": {
      "id": 1,
      "email": "user@example.com",
      "first_name": "홍",
      "last_name": "길동",
      "is_email_verified": false
    },
    "message": "인증 이메일이 발송되었습니다."
  }
}
```

### 로그인
```http
POST /auth/login/
Content-Type: application/json

{
  "email": "user@example.com",
  "password": "secure_password123"
}
```

**응답**:
```json
{
  "success": true,
  "data": {
    "access": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...",
    "refresh": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...",
    "user": {
      "id": 1,
      "email": "user@example.com",
      "first_name": "홍",
      "last_name": "길동",
      "avatar": "https://cdn.taskflow.com/avatars/1.jpg"
    }
  }
}
```

### 프로필 조회
```http
GET /auth/profile/
Authorization: Bearer <token>
```

**응답**:
```json
{
  "success": true,
  "data": {
    "id": 1,
    "email": "user@example.com",
    "first_name": "홍",
    "last_name": "길동",
    "avatar": "https://cdn.taskflow.com/avatars/1.jpg",
    "bio": "개발자입니다.",
    "timezone": "Asia/Seoul",
    "theme": "light",
    "language": "ko",
    "created_at": "2025-07-01T10:00:00Z"
  }
}
```

### 프로필 수정
```http
PATCH /auth/profile/
Content-Type: application/json
Authorization: Bearer <token>

{
  "first_name": "길동",
  "bio": "풀스택 개발자",
  "theme": "dark"
}
```

### 소셜 로그인 - Google
```http
POST /auth/social/google/
Content-Type: application/json

{
  "access_token": "google_access_token",
  "id_token": "google_id_token"
}
```

---

## 🏢 워크스페이스 API

### 워크스페이스 목록 조회
```http
GET /workspaces/
Authorization: Bearer <token>
```

**응답**:
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "name": "개인 워크스페이스",
      "description": "개인 업무 관리",
      "icon": "🏠",
      "is_personal": true,
      "role": "owner",
      "member_count": 1,
      "created_at": "2025-07-01T10:00:00Z"
    },
    {
      "id": 2,
      "name": "팀 프로젝트",
      "description": "웹 개발 프로젝트",
      "icon": "💼",
      "is_personal": false,
      "role": "admin",
      "member_count": 5,
      "created_at": "2025-07-05T15:30:00Z"
    }
  ]
}
```

### 워크스페이스 생성
```http
POST /workspaces/
Content-Type: application/json
Authorization: Bearer <token>

{
  "name": "새 프로젝트",
  "description": "새로운 협업 프로젝트",
  "icon": "🚀",
  "is_personal": false
}
```

### 워크스페이스 상세 조회
```http
GET /workspaces/{workspace_id}/
Authorization: Bearer <token>
```

**응답**:
```json
{
  "success": true,
  "data": {
    "id": 1,
    "name": "팀 프로젝트",
    "description": "웹 개발 프로젝트",
    "icon": "💼",
    "is_personal": false,
    "settings": {
      "allow_guest_access": true,
      "default_page_permission": "edit"
    },
    "my_role": "admin",
    "created_at": "2025-07-05T15:30:00Z",
    "updated_at": "2025-07-20T09:15:00Z"
  }
}
```

### 멤버 목록 조회
```http
GET /workspaces/{workspace_id}/members/
Authorization: Bearer <token>
```

**응답**:
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "user": {
        "id": 5,
        "email": "admin@example.com",
        "first_name": "관리",
        "last_name": "자",
        "avatar": "https://cdn.taskflow.com/avatars/5.jpg"
      },
      "role": "owner",
      "joined_at": "2025-07-05T15:30:00Z"
    }
  ]
}
```

### 멤버 초대
```http
POST /workspaces/{workspace_id}/invitations/
Content-Type: application/json
Authorization: Bearer <token>

{
  "email": "newmember@example.com",
  "role": "member",
  "message": "팀 프로젝트에 초대합니다."
}
```

---

## 📝 페이지 관리 API

### 페이지 목록 조회 (트리 구조)
```http
GET /workspaces/{workspace_id}/pages/
Authorization: Bearer <token>
?parent=null&expand_all=true
```

**응답**:
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "title": "프로젝트 개요",
      "icon": "📋",
      "type": "page",
      "parent": null,
      "position": 0,
      "has_children": true,
      "children": [
        {
          "id": 2,
          "title": "요구사항 분석",
          "icon": "📊",
          "type": "page",
          "parent": 1,
          "position": 0,
          "has_children": false
        }
      ],
      "created_at": "2025-07-10T10:00:00Z",
      "updated_at": "2025-07-20T14:30:00Z",
      "created_by": {
        "id": 1,
        "first_name": "홍",
        "last_name": "길동"
      }
    }
  ]
}
```

### 페이지 생성
```http
POST /workspaces/{workspace_id}/pages/
Content-Type: application/json
Authorization: Bearer <token>

{
  "title": "새 페이지",
  "icon": "📄",
  "type": "page",
  "parent": 1,
  "position": 0,
  "template": "blank"
}
```

### 페이지 상세 조회
```http
GET /workspaces/{workspace_id}/pages/{page_id}/
Authorization: Bearer <token>
```

**응답**:
```json
{
  "success": true,
  "data": {
    "id": 1,
    "title": "프로젝트 개요",
    "icon": "📋",
    "cover_image": "https://cdn.taskflow.com/covers/1.jpg",
    "type": "page",
    "parent": null,
    "position": 0,
    "properties": {
      "tags": ["개발", "기획"],
      "status": "진행중",
      "priority": "높음"
    },
    "permissions": {
      "can_edit": true,
      "can_comment": true,
      "can_share": true
    },
    "blocks": [
      {
        "id": "block_1",
        "type": "heading_1",
        "content": {
          "text": "프로젝트 개요"
        },
        "position": 0
      }
    ],
    "created_at": "2025-07-10T10:00:00Z",
    "updated_at": "2025-07-20T14:30:00Z",
    "created_by": {
      "id": 1,
      "first_name": "홍",
      "last_name": "길동"
    }
  }
}
```

### 페이지 수정
```http
PATCH /workspaces/{workspace_id}/pages/{page_id}/
Content-Type: application/json
Authorization: Bearer <token>

{
  "title": "수정된 제목",
  "icon": "✨",
  "properties": {
    "status": "완료"
  }
}
```

### 페이지 이동
```http
PATCH /workspaces/{workspace_id}/pages/{page_id}/move/
Content-Type: application/json
Authorization: Bearer <token>

{
  "parent": 2,
  "position": 1
}
```

---

## 🧩 블록 시스템 API

### 블록 생성
```http
POST /workspaces/{workspace_id}/pages/{page_id}/blocks/
Content-Type: application/json
Authorization: Bearer <token>

{
  "type": "paragraph",
  "content": {
    "text": "새로운 텍스트 블록입니다."
  },
  "position": 2,
  "parent_block": null
}
```

### 블록 수정
```http
PATCH /workspaces/{workspace_id}/pages/{page_id}/blocks/{block_id}/
Content-Type: application/json
Authorization: Bearer <token>

{
  "content": {
    "text": "수정된 텍스트 내용"
  }
}
```

### 블록 타입별 예시

#### 텍스트 블록
```json
{
  "type": "paragraph",
  "content": {
    "text": "일반 텍스트입니다.",
    "formatting": [
      {
        "type": "bold",
        "start": 0,
        "end": 2
      }
    ]
  }
}
```

#### 헤딩 블록
```json
{
  "type": "heading_1",
  "content": {
    "text": "제목입니다"
  }
}
```

#### 체크리스트 블록
```json
{
  "type": "checklist",
  "content": {
    "text": "할 일 항목",
    "checked": false
  }
}
```

#### 이미지 블록
```json
{
  "type": "image",
  "content": {
    "url": "https://cdn.taskflow.com/images/123.jpg",
    "caption": "이미지 설명",
    "width": 800,
    "height": 600
  }
}
```

### 블록 삭제
```http
DELETE /workspaces/{workspace_id}/pages/{page_id}/blocks/{block_id}/
Authorization: Bearer <token>
```

### 블록 순서 변경
```http
PATCH /workspaces/{workspace_id}/pages/{page_id}/blocks/{block_id}/move/
Content-Type: application/json
Authorization: Bearer <token>

{
  "position": 5,
  "parent_block": "block_abc123"
}
```

---

## 📅 캘린더 API

### 이벤트 목록 조회
```http
GET /workspaces/{workspace_id}/calendar/events/
Authorization: Bearer <token>
?start_date=2025-07-01&end_date=2025-07-31&view=month
```

**응답**:
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "title": "팀 미팅",
      "description": "주간 팀 미팅",
      "start_datetime": "2025-07-22T14:00:00Z",
      "end_datetime": "2025-07-22T15:00:00Z",
      "all_day": false,
      "color": "#FF5733",
      "category": "meeting",
      "linked_page": {
        "id": 15,
        "title": "팀 미팅 회의록"
      },
      "attendees": [
        {
          "user_id": 1,
          "status": "accepted"
        }
      ],
      "recurrence": {
        "frequency": "weekly",
        "interval": 1,
        "days_of_week": [1]
      },
      "reminders": [
        {
          "method": "email",
          "minutes_before": 30
        }
      ]
    }
  ]
}
```

### 이벤트 생성
```http
POST /workspaces/{workspace_id}/calendar/events/
Content-Type: application/json
Authorization: Bearer <token>

{
  "title": "새 회의",
  "description": "프로젝트 논의",
  "start_datetime": "2025-07-25T10:00:00Z",
  "end_datetime": "2025-07-25T11:00:00Z",
  "color": "#3498DB",
  "category": "meeting",
  "create_linked_page": true,
  "page_template": "meeting_notes",
  "attendees": [2, 3, 4],
  "reminders": [
    {
      "method": "email",
      "minutes_before": 15
    }
  ]
}
```

### 반복 이벤트 생성
```http
POST /workspaces/{workspace_id}/calendar/events/
Content-Type: application/json
Authorization: Bearer <token>

{
  "title": "일일 스탠드업",
  "start_datetime": "2025-07-22T09:00:00Z",
  "end_datetime": "2025-07-22T09:30:00Z",
  "recurrence": {
    "frequency": "daily",
    "interval": 1,
    "days_of_week": [1, 2, 3, 4, 5],
    "end_date": "2025-12-31"
  }
}
```

---

## 📋 칸반 보드 API

### 보드 목록 조회
```http
GET /workspaces/{workspace_id}/kanban/boards/
Authorization: Bearer <token>
```

### 보드 생성
```http
POST /workspaces/{workspace_id}/kanban/boards/
Content-Type: application/json
Authorization: Bearer <token>

{
  "title": "프로젝트 태스크",
  "description": "프로젝트 진행 상황 관리",
  "columns": [
    {
      "title": "할 일",
      "color": "#GRAY",
      "position": 0
    },
    {
      "title": "진행 중",
      "color": "#BLUE",
      "position": 1
    },
    {
      "title": "완료",
      "color": "#GREEN",
      "position": 2
    }
  ]
}
```

### 보드 상세 조회
```http
GET /workspaces/{workspace_id}/kanban/boards/{board_id}/
Authorization: Bearer <token>
```

**응답**:
```json
{
  "success": true,
  "data": {
    "id": 1,
    "title": "프로젝트 태스크",
    "description": "프로젝트 진행 상황 관리",
    "columns": [
      {
        "id": 1,
        "title": "할 일",
        "color": "#GRAY",
        "position": 0,
        "cards": [
          {
            "id": 1,
            "title": "사용자 인증 구현",
            "description": "JWT 기반 인증 시스템 구현",
            "position": 0,
            "assignees": [
              {
                "id": 1,
                "first_name": "홍",
                "last_name": "길동",
                "avatar": "https://cdn.taskflow.com/avatars/1.jpg"
              }
            ],
            "labels": [
              {
                "id": 1,
                "name": "백엔드",
                "color": "#FF5733"
              }
            ],
            "due_date": "2025-07-30T23:59:59Z",
            "checklist": [
              {
                "id": 1,
                "text": "모델 설계",
                "completed": true
              },
              {
                "id": 2,
                "text": "API 구현",
                "completed": false
              }
            ],
            "linked_page": {
              "id": 10,
              "title": "인증 시스템 문서"
            },
            "created_at": "2025-07-20T10:00:00Z"
          }
        ]